# Common λ„λ©”μΈ

## π“‹ λ„λ©”μΈ κ°μ”

ν”„λ΅μ νΈ μ „λ°μ—μ„ μ‚¬μ©λλ” κ³µν†µ κΈ°λ¥μ„ μ κ³µν•λ” λ„λ©”μΈμ…λ‹λ‹¤.

**μ£Όμ” μ±…μ„**:
- AWS μ„λΉ„μ¤ ν†µν•© (S3, SES, Secrets Manager)
- νμΌ μ—…λ΅λ“/λ‹¤μ΄λ΅λ“ (Presigned URL)
- μ΄λ©”μΌ λ°μ†΅
- μ „μ—­ μμ™Έ μ²λ¦¬
- κ³µν†µ μ‘λ‹µ ν¬λ§·
- Swagger API λ¬Έμ„ν™”
- Spring Security μ„¤μ •
- JWT ν† ν° κ΄€λ¦¬

---

## π API μ—”λ“ν¬μΈνΈ

### 1. Presigned URL μƒμ„± (νμΌ μ—…λ΅λ“)

- **μ—”λ“ν¬μΈνΈ**: `POST /api/v1/presigned`
- **μ„¤λ…**: S3μ— νμΌμ„ μ—…λ΅λ“ν•κΈ° μ„ν• Presigned URLμ„ μƒμ„±ν•©λ‹λ‹¤.
- **μΈμ¦**: ν•„μ” (JWT)
- **λ°μƒ κ°€λ¥ν• μμ™Έ**: `FILE_001` (νμΌ ν•μ‹), `FILE_002` (νμΌ ν¬κΈ° μ΄κ³Ό)

### 2. μ΄λ©”μΌ μΈμ¦ μ”μ²­

- **μ—”λ“ν¬μΈνΈ**: `POST /api/v1/verify/email`
- **μ„¤λ…**: μ΄λ©”μΌ μ£Όμ†λ΅ μΈμ¦ μ½”λ“λ¥Ό λ°μ†΅ν•©λ‹λ‹¤.
- **μΈμ¦**: λ¶ν•„μ”
- **λ°μƒ κ°€λ¥ν• μμ™Έ**: `EMAIL_VERIFY_001` (λ°μ†΅ μ‹¤ν¨), `EMAIL_VERIFY_002` (Rate Limiting)

### 3. μ΄λ©”μΌ μΈμ¦ ν™•μΈ

- **μ—”λ“ν¬μΈνΈ**: `POST /api/v1/verify/email/confirm`
- **μ„¤λ…**: λ°μ†΅λ μΈμ¦ μ½”λ“λ¥Ό ν™•μΈν•©λ‹λ‹¤.
- **μΈμ¦**: λ¶ν•„μ”
- **λ°μƒ κ°€λ¥ν• μμ™Έ**: `EMAIL_VERIFY_003` (μ½”λ“ λ¶μΌμΉ), `EMAIL_VERIFY_004` (μ½”λ“ λ§λ£)

### 4. ν—¬μ¤ μ²΄ν¬

- **μ—”λ“ν¬μΈνΈ**: `GET /health`
- **μ„¤λ…**: μ„λ²„ μƒνƒλ¥Ό ν™•μΈν•©λ‹λ‹¤.
- **μΈμ¦**: λ¶ν•„μ”

---

## π“¦ μ£Όμ” μ»΄ν¬λ„νΈ

### AWS ν†µν•©

#### S3Config
- S3Client μ„¤μ •
- Presigned URL μƒμ„± λ΅μ§
- νμΌ μ—…λ΅λ“/λ‹¤μ΄λ΅λ“ μ²λ¦¬

**μ£Όμ” μ„¤μ •**:
- Region: ap-northeast-2 (μ„μΈ)
- Bucket μ΄λ¦„: ν™κ²½λ³€μλ΅ κ΄€λ¦¬
- Presigned URL λ§λ£μ‹κ°„: 5λ¶„

#### SESConfig
- SES μ΄λ©”μΌ λ°μ†΅ μ„¤μ •
- ν…ν”λ¦Ώ κΈ°λ° μ΄λ©”μΌ λ°μ†΅

**μ£Όμ” μ„¤μ •**:
- From μ΄λ©”μΌ: ν™κ²½λ³€μλ΅ κ΄€λ¦¬
- Region: us-east-1 (SES μ ν•)

#### SecretsManagerConfig
- AWS Secrets Manager ν†µν•©
- λ―Όκ° μ •λ³΄ μλ™ λ΅λ“

**κ΄€λ¦¬ λ€μƒ**:
- λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μ •λ³΄
- JWT Secret
- OAuth Client ID/Secret

---

### μμ™Έ μ²λ¦¬

#### CommonExceptionHandler
μ „μ—­ μμ™Έ μ²λ¦¬κΈ°λ΅ λ¨λ“  μμ™Έλ¥Ό μ΅μ•„μ„ μΌκ΄€λ μ—λ¬ μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤.

**μ²λ¦¬ν•λ” μμ™Έ**:
- `CommonException`: λΉ„μ¦λ‹μ¤ μμ™Έ
- `MethodArgumentNotValidException`: Validation μ‹¤ν¨
- `HttpMessageNotReadableException`: JSON νμ‹± μ¤λ¥
- `Exception`: μμƒμΉ λ»ν• μ¤λ¥

**μ—λ¬ μ‘λ‹µ ν•μ‹**:
```json
{
  "success": false,
  "code": "ERROR_CODE",
  "message": "μ—λ¬ λ©”μ‹μ§€",
  "fieldErrors": [
    {
      "field": "email",
      "message": "μ΄λ©”μΌ ν•μ‹μ΄ μ¬λ°”λ¥΄μ§€ μ•μµλ‹λ‹¤."
    }
  ]
}
```

---

### λ³΄μ•

#### SecurityConfig
Spring Security μ„¤μ •μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

**μ£Όμ” μ„¤μ •**:
- JWT μΈμ¦ ν•„ν„° λ“±λ΅
- CORS μ„¤μ •
- CSRF λΉ„ν™μ„±ν™” (REST API)
- μΈμ¦ μ μ™Έ κ²½λ΅ μ„¤μ •

**μΈμ¦ μ μ™Έ κ²½λ΅**:
- `/health`
- `/swagger-ui/**`
- `/api-docs/**`
- `/api/v1/users/register`
- `/api/v1/users/login`
- `/api/v1/verify/**`

#### JwtTokenFilter
λ¨λ“  μ”μ²­μ—μ„ JWT ν† ν°μ„ κ²€μ¦ν•©λ‹λ‹¤.

**μ²λ¦¬ μμ„**:
1. Authorization ν—¤λ”μ—μ„ ν† ν° μ¶”μ¶
2. TokenProviderλ΅ ν† ν° κ²€μ¦
3. μ ν¨ν• κ²½μ° SecurityContextμ— μΈμ¦ μ •λ³΄ μ„¤μ •
4. λ‹¤μ ν•„ν„°λ΅ μ”μ²­ μ „λ‹¬

#### TokenProvider
JWT ν† ν° μƒμ„± λ° κ²€μ¦μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

**μ£Όμ” κΈ°λ¥**:
- Access Token μƒμ„± (λ§λ£: 1μ‹κ°„)
- Refresh Token μƒμ„± (λ§λ£: 2μ£Ό)
- ν† ν° κ²€μ¦ λ° νμ‹±
- μ‚¬μ©μ μ •λ³΄ μ¶”μ¶

---

### μ‘λ‹µ ν¬λ§·

- **ResponseDTO**: λ¨λ“  μ„±κ³µ μ‘λ‹µμ ν‘μ¤€ ν¬λ§·
- **ErrorResponseDTO**: λ¨λ“  μ—λ¬ μ‘λ‹µμ ν‘μ¤€ ν¬λ§·

---

**μ΄ λ¬Έμ„λ” Common λ„λ©”μΈμ μ»΄ν¬λ„νΈμ™€ APIλ¥Ό μ •λ¦¬ν• λ¬Έμ„μ…λ‹λ‹¤.**
**λ„λ©”μΈ λ³€κ²½ μ‹ μ΄ λ¬Έμ„λ„ ν•¨κ» μ—…λ°μ΄νΈν•΄μ£Όμ„Έμ”.**
